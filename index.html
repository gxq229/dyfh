
function isWeChat() {
    return /MicroMessenger/i.test(navigator.userAgent);
}

function getQueryParam(param) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(param);
}

function loadJSONP(url, callbackName) {
    const script = document.createElement('script');
    script.src = `${url}&callback=${callbackName}`;
    document.body.appendChild(script);
}

function handleResponse(response) {
    if (response.code === 0) {
        const url = response.data_jumplink;
        const type = response.data_type;
        
        
        switch (type) {
            case '1':
                // if (isWeChat()) {
                    document.title = response.data_title;
                    document.getElementById('app').innerHTML = '<iframe src="'+url+'" frameborder="0"></iframe>';
                // } else {
                //     window.location.href = url;
                // }
                break;
            case '2':
                window.location.href = url;
                break;
            default:
                document.title = '提示';
                document.body.innerHTML = '<h3>数据出错</h3>';
        }

    } else {
        document.title = '提示';
        document.body.innerHTML = '<h3>' + response.msg + '</h3>';
    }
}

window.onload = function() {
    const key = getQueryParam('key');
    if (!key) {
        document.title = '提示';
        document.body.innerHTML = '<h3>参数为空</h3>';
        return;
    }
    loadJSONP(`https://ylb.tqqcd.com/common/wxdmqkCallBack/?key=${key}`, 'handleResponse');
};
